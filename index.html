
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"> 

    <title></title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/offcanvas.css" rel="stylesheet">
    <link href="css/pos.css" rel="stylesheet">
    <link href="css/pad.css" rel="stylesheet">
  </head>

  <body>
      
      <nav class="navbar navbar-inverse navbar-fixed-top vis-print">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed hidden-print" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand sitename vis-print" href="#"></a>
        </div>
        <div id="navbar">
          <form class="navbar-form navbar-right">
            <button class="btn btn-success defaultable vis-print " id="btn_total" data-default="Total: $"></button>
            <button class="btn btn-warning defaultable userinputdefaultable hidden-xs vis-print" id="btn_tendered" data-default="Tendered: $"></button>
            <button class="btn btn-info defaultable userinputdefaultable hidden-xs vis-print" id="btn_change" data-default="Change: $"></button>
            <button class="btn btn-danger hidden-print" id="btn_Clear" onclick="clearAmount();return false;">Clear</button>
          </form>
        </div><!--/.navbar-collapse -->
      </div>
      
    </nav><!-- /.navbar -->
    
    <div class="visible-xs-block"><p style="height:60px;">&nbsp;</p></div>

    <div class="container">
      <div class="row row-offcanvas row-offcanvas-right">
          
        <div class="col-xs-11 col-sm-8 hidden-print">
          <div class="row" id="inventory"></div><!--/row-->
        </div><!--/.col-xs-12.col-sm-9-->

        <div class="col-xs-7 col-sm-4 sidebar-offcanvas" id="sidebar">
            
            <div class="row hidden-print">
                <div class="list-group" style="margin-left:50px;">
                    <input type="tel" name="name" id="telNumber" class="form-control tel" value="" style="display:none;"/>
                        <div class="num-pad">
                            <div class="span4"><div class="num"><div class="txt">7</div></div></div>
                            <div class="span4"><div class="num"><div class="txt">8</div></div></div>
                            <div class="span4"><div class="num"><div class="txt">9</div></div></div>
                            <div class="span4"><div class="num"><div class="txt">4</div></div></div>
                            <div class="span4"><div class="num"><div class="txt">5</div></div></div>
                            <div class="span4"><div class="num"><div class="txt">6</div></div></div>
                            <div class="span4"><div class="num"><div class="txt">1</div></div></div>
                            <div class="span4"><div class="num"><div class="txt">2</div></div></div>
                            <div class="span4"><div class="num"><div class="txt">3</div></div></div>
                            <div class="span4"><div class="num" style="background-color:#E51400;"><div class="txt">c</div></div></div>
                            <div class="span4"><div class="num"><div class="txt">0</div></div></div>
                            <div class="span4"></div>
                        </div>
                </div>
            </div>
            
            <div class="row receiptrow" >
                <h1 class="visible-print" style="margin-top:50px;">Purchased Items:</h1>
                <div class="list-group receiptrow" id="purchasedItemsDiv">
                    <ul id="purchasedItems receiptrow"></ul>
                </div>
            </div>
         
        </div><!--/.sidebar-offcanvas-->
      </div><!--/row-->
      
      <footer class="hidden-print">
        <hr>
        <p class="sitename"></p>
      </footer>

        <div class="row visible-print">
            <div class="col-xs-4"></div>
            <div class="col-xs-4">
                <center>
                    <span id="eventname"></span>
                    <br><span id="website"></span>
                    <br><span id="dt"></span>
                    <br><img src="" id="logo" width="100" />
                </center>
                </div>
            <div class="col-xs-4"></div>    
        </div>

    </div><!--/.container-->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery.js"></script>
    <script src="js/jquery-dateFormat.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="js/ie10-viewport-bug-workaround.js"></script>
    
    <script type="text/javascript">
        var purchased = [];
        var total = 0;
        
		function jsonpCallback(json) {   
			$.each(json.products, function(i, item) {
				var id = json.products[i].id;
				var name = json.products[i].name;
				var price = json.products[i].price;
				var itemType = json.products[i].itemType;
                var html = '<div id="div_'+id+'" class="col-xs-6 col-lg-4 items '+itemType+'" data-price="'+price+'" data-name="'+name+'" onclick="addAmount('+id+');"><h2>'+name+'</h2><p>'+price+'</p></div>'
				
				$('#inventory').append(html);
			});
            
            $(".sitename").html(json.sitename);
            $("title").html(json.sitename);
            $('#eventname').html(json.eventname);
            $('#website').html(json.website);
            $('#logo').attr('src','imgs/'+json.logo);
	
		}
		function addAmount(id) {
			var amnt = $('#div_'+id).attr("data-price");
			var currAmnt = total * 1;
			var result = currAmnt + amnt*1;

			var name = $('#div_'+id).attr("data-name");

			total = result.toFixed(2);
            
            if (purchased.length == 0 ) {
                purchased.push({"id":id, "name":name,"qty":1,"amt":amnt});
            }
            else 
            {
                var alreadyPurchased = false;
                
                $.each(purchased, function(i, item) {
                    if (item.id == id) {
                        item.qty = (item.qty*1) + 1;
                        alreadyPurchased = true;
                    } 
                });
                
                if (alreadyPurchased == false) {
                        purchased.push({"id":id, "name":name,"qty":1,"amt":amnt});
                }
            }
            
            drawReciept();
            
            if($('#btn_tendered').html().indexOf(".") > - 1) {
                calcChange();
            }
		}
        
        function drawReciept() {
            $('#purchasedItemsDiv').html('<ul id="purchasedItems"></ul>');
            $.each(purchased, function(i, item) {
                $('#purchasedItems').append('<div class="list-group-item"><div class="itemholder"><span class="itemqty">'+item.qty+'x</span> '+item.name+' <div class="itemprice">($'+item.amt+')</div></div></div>');
            });
            
            $('#btn_total').html('Total: $'+total);
        }
		function clearAmount(){
            total = 0;
			$('#purchasedItemsDiv').html('<ul id="purchasedItems"></ul>');
            purchased = [];
            
            
            $.each($('.defaultable'), function(i, item) {
                $(this).html($(this).data('default'));
            });
            
            $('#telNumber').val('');
            
            $('#dt').html($.format.date(new Date().getTime(), "MM/dd/yyyy HH:mm"));
            
            return false;
		}
        
        function calcChange() {
            if($('#telNumber').val() != '') {
                var tendered = $('#telNumber').val() * 1;
                $('#tendered').html(tendered.toFixed(2));
                
                var change = ((tendered*1) - (total*1));
                
                $('#btn_change').html('Change: $'+change.toFixed(2));
                $('#btn_tendered').html('Tendered: $'+tendered.toFixed(2));
            }
            else {
                $.each($('.userinputdefaultable'), function(i, item) {
                    $(this).html($(this).data('default'));
                });
            }
        }
        
        $(document).ready(function () {
            $('.num').click(function () {
                var num = $(this);
                var text = $.trim(num.find('.txt').clone().children().remove().end().text());
                
                if(text == "c") {
                    $('#telNumber').val('');
                }
                else {
                    var telNumber = $('#telNumber');
                    $(telNumber).val(telNumber.val() + text);
                }
                
                calcChange();
            });
            
            clearAmount();
        });
		
	</script>
    
    <script src="products.js" type="text/javascript"></script>
  </body>
</html>
